@using Data.Models
@using aura_web_blazor.Services;
@inject IOrderService OrderService;
<style>
    .mud-tabs-panels {
        padding: 0px !important;
    }
</style>
<PageTitle>Produktet e shitura</PageTitle>
@*<MudText Align="Align.Center" Style="margin-bottom:15px;margin-top:30px; font-size:18px; font-weight:bold;">Produktet e shitura</MudText>*@
<MudItem xs="12">

</MudItem>
<ButtonKthehuComponent></ButtonKthehuComponent>

<MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true"  PanelClass="pa-6">
    <MudTabPanel  Text="Te gjitha kategorit">
        <TableProduktetDetailsComponent Prods="@GetProduktetEGrumbulluara()"></TableProduktetDetailsComponent>
    </MudTabPanel>
    @foreach(KeyValuePair<string, string> entry in Data.Categories.Category)
    {
        <MudTabPanel Style="padding-left:0px;" Text="@entry.Key">
            <TableProduktetDetailsComponent Prods="@GetProduktetEGrumbulluara(entry.Value)"></TableProduktetDetailsComponent>
        </MudTabPanel>
    }
</MudTabs>

@code {

    private IEnumerable<Produktet>? Prods;

    
    public IEnumerable<DetaletEFaturimit> Orders { get; set; }


    protected override async Task OnInitializedAsync()
    {
        Orders = (await OrderService.GetOrders()).ToList();
        Prods = from d in Orders
                        group d by new
                        {
                            d.Artikulli,
                            d.Qmimi,
                            d.Nj2
                        } into grp
                        select new Produktet
                        {
                            Produkti = grp.Key.Artikulli,
                            Qmimi = grp.Key.Qmimi,
                            Sasia = grp.Sum(d => int.Parse(d.Sasia)),
                            Vlera = grp.Sum(d => decimal.Parse(d.Vlera)),
                            Nj2 = grp.Key.Nj2
                        };

    }

    public IEnumerable<Produktet> GetProduktetEGrumbulluara(string category)
    {
       return Prods.Where(d=>d.Nj2.Equals(category)).OrderByDescending(d=>d.Sasia);
    }
    public IEnumerable<Produktet> GetProduktetEGrumbulluara()
    {
       return Prods.OrderByDescending(d=>d.Sasia);
    }
        
    }