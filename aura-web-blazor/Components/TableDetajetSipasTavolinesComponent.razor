@using aura_web_blazor.Components
@using Data.Models
@using aura_web_blazor.Services
@inject IOrderService OrderService
@inject NavigationManager UriHelper 
@*<MudText Align="Align.Center" Style="margin-bottom:15px;margin-top:30px; font-size:16px; font-weight:bold;">Faturat e fundit</MudText>*@

<MudTable Striped=false Filter="new Func<DetaletEFaturimit,bool>(FilterFunc1)" @bind-SelectedItem="selectedItem1" Hover=true Dense=true Style="font-size:small;" Items="@GetFaturat(@Aktive)" Breakpoint="Breakpoint.None" >
    <ToolBarContent>
        <MudTextField @bind-Value="searchString1" FullWidth=true Placeholder="Kerko sipas kamarierit" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0 mb-2"></MudTextField>
        <MudSpacer />
    </ToolBarContent>
    <HeaderContent>
        <MudTh Style="font-weight:bold">Produkti</MudTh>
        <MudTh Style="font-weight:bold">Sasia</MudTh>
        <MudTh Style="font-weight:bold">Vlera</MudTh>
        <MudTh Style="font-weight:bold">Kamarieri</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd Style="text-align:left" >@context.Artikulli</MudTd>
        <MudTd Style="text-align:center">@context.Sasia</MudTd>
        <MudTd Style="text-align:center">@context.Vlera€</MudTd>
        <MudTd Style="text-align:center">@context.Kamarieri <br /> @DateTime.Parse(context.Ora).ToString("HH:mm:ss")</MudTd>
    </RowTemplate>
</MudTable>

@code {
    
    [Parameter]
    public string Tavolina { get; set; }
    [Parameter]
    public bool Aktive { get; set; }
    
     private string searchString1 = "";
    private DetaletEFaturimit selectedItem1 = null;
    private HashSet<DetaletEFaturimit> selectedItems = new HashSet<DetaletEFaturimit>();

    private IEnumerable<DetaletEFaturimit>? Orders;


    protected override async Task OnInitializedAsync()
    {
        Orders = (await OrderService.GetOrders()).ToList();
    }

    protected IEnumerable<DetaletEFaturimit> GetFaturat(bool aktive)
    {
        if(aktive)
         return Orders.Where(d=>d.Tavolina.Equals(Tavolina)).Where(d=>d.EshteMbyllur.Equals(d.Tavolina)).OrderByDescending(d => DateTime.Parse(d.Ora));
        else
         return Orders.Where(d=>d.Tavolina.Equals(Tavolina)).Where(d=>d.EshteMbyllur.Equals("x") ||d.EshteMbyllur.Equals("X") ).OrderByDescending(d => DateTime.Parse(d.Ora));
    }

        private bool FilterFunc1(DetaletEFaturimit element) => FilterFunc(element, searchString1);

    private bool FilterFunc(DetaletEFaturimit element, string searchString)
    {
        if (string.IsNullOrWhiteSpace(searchString))
            return true;
        if (element.Kamarieri.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        return false;
    }
}
