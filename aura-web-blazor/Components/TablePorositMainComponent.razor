@using Data.Models
@using aura_web_blazor.Services
@inject NavigationManager UriHelper
@inject IOrderService OrderService
<MudText Align="Align.Center" Style="margin-bottom:15px;margin-top:30px; font-size:16px; font-weight:bold;">Faturat e fundit</MudText>

<MudTable Class="rounded-lg" Striped=false Hover=true Dense=true Style="font-size:small;;" Items="@GetFaturat(true)" Breakpoint="Breakpoint.None" >
    <HeaderContent>
        <MudTh Style="font-weight:bold">Produkti</MudTh>
        <MudTh Style="font-weight:bold">Sasia</MudTh>
        <MudTh Style="font-weight:bold">Tavolina</MudTh>
        <MudTh Style="font-weight:bold">Kamarieri</MudTh>
        <MudTh Style="font-weight:bold">Vlera</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd Style="text-align:left">@context.Artikulli</MudTd>
        <MudTd Style="text-align:center">@context.Sasia</MudTd>
        <MudTd Style="text-align:center">@context.Tavolina <br /> @DateTime.Parse(context.Ora).ToString("HH:mm:ss")</MudTd>
        <MudTd Style="text-align:center">@context.Kamarieri</MudTd>
        <MudTd >@decimal.Parse(context.Vlera).ToString("0.00")€</MudTd>
    </RowTemplate>
@*    <FooterContent >
            
            <MudButton @onclick=Navigate> @(TakeAll ? "Kthehu" : "Shiko te gjitha")</MudButton>
    </FooterContent>*@
    <PagerContent >
        <MudTablePager RowsPerPageString="Rreshtat::"/>
    </PagerContent>
</MudTable>


@code {
    bool fixed_header = true;
    bool fixed_footer = true;

    private IEnumerable<DetaletEFaturimit>? Orders;

    [Parameter]
    public bool TakeAll { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Orders = (await OrderService.GetOrders()).ToList();
    }

    void Navigate()
    {
        if(!TakeAll)
        UriHelper.NavigateTo("faturat");
        else
        UriHelper.NavigateTo("/");
    }

    protected IEnumerable<DetaletEFaturimit> GetFaturat(bool TakeAll)
    {
        if (TakeAll)
            return Orders.OrderByDescending(d => DateTime.Parse(d.Ora));
        else
            return Orders.OrderByDescending(d => DateTime.Parse(d.Ora)).Take(15);
    }
}
